[build-system]
requires = ["setuptools>=61.0", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "doc-nmt-mamba"
version = "0.1.0"
description = "Document-Level Neural Machine Translation with Hybrid Mamba-Attention Architecture"
readme = "research_implementation_plan.md"
license = {text = "MIT"}
requires-python = ">=3.10"
authors = [
    {name = "Indrajeet Aditya Roy"}
]
keywords = ["nmt", "machine-translation", "mamba", "transformer", "deep-learning"]
classifiers = [
    "Development Status :: 3 - Alpha",
    "Intended Audience :: Science/Research",
    "License :: OSI Approved :: MIT License",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Topic :: Scientific/Engineering :: Artificial Intelligence",
]

dependencies = [
    # Core ML framework (PyTorch installed via install_env.sh for CUDA compatibility)
    # "torch>=2.3.0",  # Handled by install_env.sh

    # Configuration management
    "hydra-core>=1.3.2",
    "omegaconf>=2.3.0",

    # Data processing
    "numpy<2.0.0",  # Keep <2.0 for ecosystem compatibility
    "tokenizers>=0.19.0",
    "transformers>=4.40.0",
    "datasets>=2.19.0",
    "pandas>=2.2.0",

    # Evaluation metrics
    "sacrebleu[ko]>=2.4.2",
    "evaluate>=0.4.2",

    # Utilities
    "tqdm>=4.66.0",
    "wandb>=0.17.0",

    # Hardware monitoring
    "psutil>=5.9.8",
    "pynvml>=11.5.0",
]

[project.optional-dependencies]
# CUDA dependencies (Linux only, requires CUDA 12.1+)
# IMPORTANT: Install via install_env.sh, not pip install .[cuda]
# These require --no-build-isolation for proper CUDA header linking
cuda = [
    "mamba-ssm>=2.0.0",
    "causal-conv1d>=1.2.0",
]

# FlashAttention-2 for memory-efficient attention (H100 optimized)
# IMPORTANT: Install via install_env.sh with --no-build-isolation
flash = [
    "flash-attn>=2.5.8",
]

# COMET neural evaluation metric (NeurIPS standard)
comet = [
    "unbabel-comet>=2.2.2",
]

# Word alignment for AER evaluation
alignment = [
    "awesome-align>=0.1.7",
]

# spaCy for Entity Recall analysis
nlp = [
    "spacy>=3.7.4",
    "scipy>=1.13.0",
]

# Visualization tools
viz = [
    "matplotlib>=3.8.4",
    "seaborn>=0.13.2",
]

# Development dependencies
dev = [
    "pytest>=8.2.0",
    "pytest-cov>=4.1.0",
    "black>=24.4.2",
    "isort>=5.13.2",
    "mypy>=1.10.0",
]

# All optional dependencies (for GPU environments)
# NOTE: For H100, use install_env.sh instead of pip install .[all]
all = [
    "mamba-ssm>=2.0.0",
    "causal-conv1d>=1.2.0",
    "flash-attn>=2.5.8",
    "unbabel-comet>=2.2.2",
    "awesome-align>=0.1.7",
    "spacy>=3.7.4",
    "scipy>=1.13.0",
    "matplotlib>=3.8.4",
    "seaborn>=0.13.2",
    "pytest>=8.2.0",
    "pytest-cov>=4.1.0",
    "black>=24.4.2",
    "isort>=5.13.2",
    "mypy>=1.10.0",
]

# CPU-only installation (for development/testing without GPU)
cpu = [
    "unbabel-comet>=2.2.2",
    "awesome-align>=0.1.7",
    "spacy>=3.7.4",
    "scipy>=1.13.0",
    "matplotlib>=3.8.4",
    "seaborn>=0.13.2",
    "pytest>=8.2.0",
    "pytest-cov>=4.1.0",
    "black>=24.4.2",
    "isort>=5.13.2",
    "mypy>=1.10.0",
]

[project.urls]
Homepage = "https://github.com/indrajeetadityaroy/NMT_English_to_Vietnamese"

[project.scripts]
nmt-train = "doc_nmt_mamba.scripts.train:main"
nmt-evaluate = "doc_nmt_mamba.scripts.evaluate:main"
nmt-build-tokenizer = "doc_nmt_mamba.scripts.build_tokenizer:main"

[tool.setuptools.packages.find]
where = ["."]
include = ["doc_nmt_mamba*"]

[tool.setuptools.package-data]
"doc_nmt_mamba" = ["configs/**/*.yaml"]

[tool.pytest.ini_options]
testpaths = ["doc_nmt_mamba/tests"]
python_files = ["test_*.py"]
python_functions = ["test_*"]
addopts = "-v --tb=short"
filterwarnings = [
    "ignore::DeprecationWarning",
    "ignore::UserWarning",
]

[tool.black]
line-length = 100
target-version = ["py310", "py311", "py312"]
include = '\.pyi?$'
exclude = '''
/(
    \.git
    | \.venv
    | venv
    | build
    | dist
    | outputs
    | data
)/
'''

[tool.isort]
profile = "black"
line_length = 100
skip = [".git", ".venv", "venv", "build", "dist", "outputs", "data"]

[tool.mypy]
python_version = "3.10"
warn_return_any = true
warn_unused_configs = true
ignore_missing_imports = true
exclude = [
    "venv",
    ".venv",
    "build",
    "dist",
    "outputs",
]
